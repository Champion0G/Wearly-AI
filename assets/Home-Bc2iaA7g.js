import{r,u as L,j as a}from"./index-6br1IWsU.js";const n={CACHE_KEY:"wearly_products_cache",CACHE_DURATION:5*60*1e3,MAX_CACHE_SIZE:10*1024*1024},p={getCache:()=>{try{const s=localStorage.getItem(n.CACHE_KEY);if(!s)return null;const{data:i,timestamp:c}=JSON.parse(s);return Date.now()-c>n.CACHE_DURATION?(localStorage.removeItem(n.CACHE_KEY),null):i}catch(s){return console.error("Error reading cache:",s),null}},setCache:s=>{try{const i={data:s,timestamp:Date.now()};if(JSON.stringify(i).length>n.MAX_CACHE_SIZE){console.warn("Cache size exceeds limit, clearing cache"),localStorage.removeItem(n.CACHE_KEY);return}localStorage.setItem(n.CACHE_KEY,JSON.stringify(i))}catch(i){console.error("Error writing to cache:",i)}},clearCache:()=>{try{localStorage.removeItem(n.CACHE_KEY)}catch(s){console.error("Error clearing cache:",s)}}},G=[{id:"1001",name:"Classic Cotton T-Shirt",price:19.99,image:"https://images.unsplash.com/photo-1523381210434-271e8be1f52b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",category:"T-Shirts",description:"A comfortable cotton t-shirt perfect for everyday wear.",sizes:[{name:"S",availability:"in_stock"},{name:"M",availability:"in_stock"},{name:"L",availability:"in_stock"}]},{id:"1002",name:"Slim Fit Jeans",price:39.99,image:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",category:"Jeans",description:"Modern slim fit jeans with a stylish wash.",sizes:[{name:"30",availability:"in_stock"},{name:"32",availability:"in_stock"},{name:"34",availability:"in_stock"}]},{id:"1003",name:"Casual Hoodie",price:44.99,image:"https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",category:"Hoodies",description:"A warm and cozy hoodie perfect for chilly days.",sizes:[{name:"S",availability:"in_stock"},{name:"M",availability:"in_stock"},{name:"L",availability:"in_stock"},{name:"XL",availability:"in_stock"}]}];function B(){const[s,i]=r.useState([]),[c,m]=r.useState(!0),[h,I]=r.useState(null),[x,z]=r.useState(0),[y,v]=r.useState(!0),D=L(),C=r.useCallback(async e=>{const d=p.getCache();if(d&&e===0){i(d),m(!1);return}const Y={method:"GET",headers:{"X-RapidAPI-Key":"79f78136ffmsh2587f6e96e44266p1dddc5jsne1f773947bac","X-RapidAPI-Host":"apidojo-hm-hennes-mauritz-v1.p.rapidapi.com"}};try{const l=await fetch(`https://apidojo-hm-hennes-mauritz-v1.p.rapidapi.com/products/list?country=us&lang=en&currentpage=${e}&pagesize=12&categories=men_all&concepts=H%26M%20MAN`,Y);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const o=await l.json();if(o.results&&o.results.length>0){const f=o.results.map(t=>{var E,b,j,w,H,N,_,A,S,M,k;return{id:((E=t.defaultArticle)==null?void 0:E.code)||t.code,name:t.name,price:((b=t.price)==null?void 0:b.value)||0,image:((N=(H=(w=(j=t.articles)==null?void 0:j[0])==null?void 0:w.images)==null?void 0:H[0])==null?void 0:N.url)||((A=(_=t.galleryImages)==null?void 0:_[0])==null?void 0:A.url)||((M=(S=t.images)==null?void 0:S[0])==null?void 0:M.url)||"https://via.placeholder.com/300x400?text=No+Image",category:t.categoryName,description:t.description||"",sizes:((k=t.variantSizes)==null?void 0:k.map(u=>({name:u.filterCode||u.name,availability:u.availability||"in_stock"})))||[]}});e===0?(p.setCache(f),i(f)):i(t=>[...t,...f]),v(o.results.length===12)}else v(!1)}catch(l){if(console.error("Error fetching products:",l),I(l.message),e===0){const o=p.getCache();i(o||G)}}finally{m(!1)}},[]);r.useEffect(()=>{C(x)},[x,C]);const P=e=>{D(`/product/${e.id}`,{state:{product:{id:e.id,name:e.name,price:e.price,image:e.image,images:[e.image],description:e.description||"No description available",category:e.category,sizes:e.sizes||[],details:[],care:[]}}})},g=r.useCallback(()=>{window.innerHeight+document.documentElement.scrollTop===document.documentElement.offsetHeight&&!c&&y&&z(e=>e+1)},[c,y]);return r.useEffect(()=>(window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)),[g]),c&&s.length===0?a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loader"}),a.jsx("p",{children:"Loading amazing products..."})]}):h&&!s.length?a.jsx("div",{className:"error-message",children:h}):a.jsxs("div",{className:"home",children:[a.jsxs("div",{className:"hero-section",children:[a.jsx("h1",{children:"Welcome to WEARLY"}),a.jsx("p",{className:"tagline",children:"Buy before you try"})]}),a.jsxs("div",{className:"products-section",children:[a.jsx("h2",{children:"Featured Products"}),h&&a.jsx("div",{className:"error-banner",children:"Unable to refresh products. Showing cached data."}),a.jsx("div",{className:"products-grid",children:s.map(e=>a.jsxs("div",{className:"product-card",onClick:()=>P(e),children:[a.jsxs("div",{className:"product-image",children:[a.jsx("img",{src:e.image,alt:e.name,loading:"lazy",onError:d=>{d.target.onerror=null,d.target.src="https://via.placeholder.com/300x400?text=No+Image"}}),a.jsx("div",{className:"hover-overlay",children:a.jsx("button",{className:"view-button",children:"View Details"})})]}),a.jsxs("div",{className:"product-details",children:[a.jsx("h3",{children:e.name}),a.jsx("p",{className:"category",children:e.category}),a.jsxs("p",{className:"price",children:["$",e.price]})]})]},e.id))}),c&&s.length>0&&a.jsxs("div",{className:"loading-more",children:[a.jsx("div",{className:"loader"}),a.jsx("p",{children:"Loading more products..."})]})]})]})}export{B as default};
